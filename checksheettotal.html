<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¥ë¹„ ì ê²€ í˜„í™© ì¡°íšŒ</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  body { 
    font-family: "Noto Sans KR", sans-serif; 
    margin: 20px; 
    background: #f8f9fa;
  }
  
  .header {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .header-left {
    flex: 1;
  }
  
  h2 {
    margin: 0 0 20px 0;
    color: #333;
  }
  
  .controls {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    align-items: center;
  }
  
  .control-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }
  
  .control-group label {
    font-size: 14px;
    color: #666;
    font-weight: 500;
  }
  
  select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
    min-width: 150px;
    cursor: pointer;
  }
  
  button {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    background: #007bff;
    color: white;
    cursor: pointer;
    font-size: 14px;
    margin-top: 20px;
  }
  
  button:hover {
    background: #0056b3;
  }
  
  .print-btn {
    background: #28a745;
    margin-top: 0;
    margin-left: 20px;
  }
  
  .print-btn:hover {
    background: #218838;
  }
  
  .table-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    overflow-x: auto;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  table {
    border-collapse: collapse;
    width: 100%;
    min-width: 1500px;
  }
  
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
    font-size: 13px;
    white-space: nowrap;
  }
  
  th {
    background: #f5f5f5;
    font-weight: bold;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  .fixed-col-1 {
    position: sticky;
    left: 0;
    background: white;
    z-index: 5;
    min-width: 90px;
  }
  
  .fixed-col-2 {
    position: sticky;
    left: 90px;
    background: white;
    z-index: 5;
    min-width: 100px;
  }
  
  .fixed-col-3 {
    position: sticky;
    left: 190px;
    background: white;
    z-index: 5;
    min-width: 120px;
  }
  
  .fixed-col-4 {
    position: sticky;
    left: 310px;
    background: white;
    z-index: 5;
    min-width: 120px;
  }
  
  .fixed-col-5 {
    position: sticky;
    left: 430px;
    background: white;
    z-index: 5;
    min-width: 80px;
    border-right: 2px solid #999 !important;
  }
  
  .fixed-col-header-1 {
    position: sticky;
    left: 0;
    background: #f5f5f5;
    z-index: 15;
    min-width: 90px;
  }
  
  .fixed-col-header-2 {
    position: sticky;
    left: 90px;
    background: #f5f5f5;
    z-index: 15;
    min-width: 100px;
  }
  
  .fixed-col-header-3 {
    position: sticky;
    left: 190px;
    background: #f5f5f5;
    z-index: 15;
    min-width: 120px;
  }
  
  .fixed-col-header-4 {
    position: sticky;
    left: 310px;
    background: #f5f5f5;
    z-index: 15;
    min-width: 120px;
  }
  
  .fixed-col-header-5 {
    position: sticky;
    left: 430px;
    background: #f5f5f5;
    z-index: 15;
    min-width: 80px;
    border-right: 2px solid #999 !important;
  }
  
  .day-header {
    min-width: 60px;
    font-size: 12px;
  }
  
  .result-cell {
    min-width: 60px;
  }
  
  .result-ok {
    background: #d4edda;
    color: #155724;
  }
  
  .result-ng {
    background: #f8d7da;
    color: #721c24;
  }
  
  .result-text {
    background: #fff3cd;
    color: #856404;
    font-size: 11px;
  }
  
  .loading {
    text-align: center;
    padding: 40px;
    color: #666;
  }
  
  .no-data {
    text-align: center;
    padding: 40px;
    color: #999;
  }
  
  .info-col {
    text-align: left;
    padding-left: 10px;
  }
  
  /* íŠ¹ì´ì‚¬í•­ ì„¹ì…˜ */
  .special-notes {
    margin-top: 30px;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .special-notes h3 {
    margin: 0 0 15px 0;
    color: #333;
  }
  
  .week-notes {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 15px;
  }
  
  .week-box {
    background: #f8f9fa;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 15px;
  }
  
  .week-box h4 {
    margin: 0 0 10px 0;
    color: #007bff;
    font-size: 14px;
  }
  
  .week-box .content {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 10px;
    min-height: 100px;
    font-size: 13px;
    color: #333;
    white-space: pre-wrap;
    word-break: break-word;
  }
  
  .week-box .content.empty {
    color: #999;
    font-style: italic;
  }
  
  /* ì¶œë ¥ ìŠ¤íƒ€ì¼ */
  @media print {
    @page {
      size: A4 landscape; /* ê°€ë¡œ ë°©í–¥ ì¶œë ¥ */
      margin: 10mm;
    }
    
    body { 
      margin: 0; 
      background: white;
    }
    
    .no-print { 
      display: none !important; 
    }
    
    .print-header { 
      display: block !important; 
    }
    
    .table-container {
      box-shadow: none;
      padding: 10px;
      overflow: visible;
    }
    
    table {
      min-width: 0 !important;
      width: 100% !important;
      font-size: 8px !important;
      page-break-inside: auto;
    }
    
    th, td {
      padding: 3px 2px !important;
      font-size: 8px !important;
      white-space: nowrap;
    }
    
    .fixed-col-1, .fixed-col-2, .fixed-col-3, .fixed-col-4, .fixed-col-5,
    .fixed-col-header-1, .fixed-col-header-2, .fixed-col-header-3, .fixed-col-header-4, .fixed-col-header-5 {
      position: static !important;
    }
    
    .info-col {
      font-size: 7px !important;
      max-width: 80px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .day-header {
      min-width: 20px !important;
      font-size: 7px !important;
    }
    
    .result-cell {
      min-width: 20px !important;
      font-size: 9px !important;
    }
    
    .special-notes {
      box-shadow: none;
      page-break-before: avoid; /* ê°™ì€ í˜ì´ì§€ì— í‘œì‹œ */
      margin-top: 15px;
      padding: 10px;
      font-size: 10px;
    }
    
    .special-notes h3 {
      font-size: 12px !important;
      margin-bottom: 8px !important;
    }
    
    .week-notes {
      gap: 8px;
    }
    
    .week-box {
      padding: 8px;
    }
    
    .week-box h4 {
      font-size: 10px !important;
      margin-bottom: 5px !important;
    }
    
    .week-box .content {
      font-size: 8px !important;
      min-height: 40px;
      padding: 5px;
    }
  }
  
  .print-header {
    display: none;
    text-align: center;
    margin-bottom: 30px;
    position: relative;
    padding-top: 20px;
  }
  
  .print-header h1 {
    margin: 0;
    font-size: 24px;
    color: #333;
  }
  
  .print-header .equipment-info {
    margin-top: 15px;
    font-size: 18px;
    color: #666;
  }
  
  .approval-box {
    position: absolute;
    top: 20px;
    right: 20px;
    border: 2px solid #000;
    padding: 5px;
  }
  
  .approval-box table {
    border-collapse: collapse;
    margin: 0;
    min-width: 0;
  }
  
  .approval-box td {
    border: 1px solid #000;
    padding: 8px 15px;
    text-align: center;
    font-size: 12px;
    white-space: nowrap;
  }
  
  .approval-title {
    font-weight: bold;
    background: #f0f0f0;
  }
</style>
</head>
<body>

<div class="header no-print">
  <div class="header-left">
    <h2>ğŸ“Š ì¥ë¹„ ì ê²€ í˜„í™© ì¡°íšŒ</h2>
    
    <div class="controls">
      <div class="control-group">
        <label>ì¥ë¹„ ì„ íƒ</label>
        <select id="equipmentSelect">
          <option value="">-- ì¥ë¹„ ì„ íƒ --</option>
          <option value="1. ìŠ¤í¬ë˜ë°”">1. ìŠ¤í¬ë˜ë°”</option>
          <option value="2. ìˆœìˆ˜ì„¤ë¹„50">2. ìˆœìˆ˜ì„¤ë¹„50</option>
          <option value="3. ìˆœìˆ˜ì„¤ë¹„100">3. ìˆœìˆ˜ì„¤ë¹„100</option>
          <option value="4. ìˆœìˆ˜ì„¤ë¹„200">4. ìˆœìˆ˜ì„¤ë¹„200</option>
          <option value="5. ìŠ¤í¬ë¥˜ì½¤í”„">5. ìŠ¤í¬ë¥˜ì½¤í”„</option>
          <option value="6. ì˜¤ì¼í”„ë¦¬ì½¤í”„50">6. ì˜¤ì¼í”„ë¦¬ì½¤í”„50</option>
          <option value="7. ì˜¤ì¼í”„ë¦¬ì½¤í”„100">7. ì˜¤ì¼í”„ë¦¬ì½¤í”„100</option>
        </select>
      </div>
      
      <div class="control-group">
        <label>ì—°ë„</label>
        <select id="yearSelect">
          <option value="">-- ì—°ë„ ì„ íƒ --</option>
        </select>
      </div>
      
      <div class="control-group">
        <label>ì›”</label>
        <select id="monthSelect">
          <option value="">-- ì›” ì„ íƒ --</option>
          <option value="1">1ì›”</option>
          <option value="2">2ì›”</option>
          <option value="3">3ì›”</option>
          <option value="4">4ì›”</option>
          <option value="5">5ì›”</option>
          <option value="6">6ì›”</option>
          <option value="7">7ì›”</option>
          <option value="8">8ì›”</option>
          <option value="9">9ì›”</option>
          <option value="10">10ì›”</option>
          <option value="11">11ì›”</option>
          <option value="12">12ì›”</option>
        </select>
      </div>
      
      <button id="searchBtn">ğŸ“‹ ì¡°íšŒí•˜ê¸°</button>
    </div>
  </div>
  
  <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ ì¶œë ¥</button>
</div>

<div class="print-header">
  <div class="approval-box">
    <table>
      <tr>
        <td class="approval-title">ë‹´ë‹¹</td>
        <td class="approval-title">ê²€í† </td>
        <td class="approval-title">ìŠ¹ì¸</td>
      </tr>
      <tr>
        <td style="width: 60px; height: 60px;"></td>
        <td style="width: 60px; height: 60px;"></td>
        <td style="width: 60px; height: 60px;"></td>
      </tr>
    </table>
  </div>
  <h1>ì¥ë¹„ ì ê²€ í˜„í™©</h1>
  <div class="equipment-info">
    <strong>ì¥ë¹„ëª…:</strong> <span id="printEquipName">-</span> | 
    <strong>ì ê²€ì›”:</strong> <span id="printMonth">-</span>
  </div>
</div>

<div class="table-container">
  <div id="tableContent">
    <div class="no-data">ì¥ë¹„, ì—°ë„, ì›”ì„ ì„ íƒí•˜ê³  ì¡°íšŒí•˜ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
  </div>
</div>

<!-- íŠ¹ì´ì‚¬í•­ ì£¼ì°¨ë³„ ëˆ„ì  ì„¹ì…˜ -->
<div class="special-notes" id="specialNotesSection" style="display: none;">
  <h3>ğŸ“‹ íŠ¹ì´ì‚¬í•­ (ì£¼ì°¨ë³„ ëˆ„ì )</h3>
  <div class="week-notes">
    <div class="week-box">
      <h4>1ì£¼ì°¨</h4>
      <div class="content empty" id="week1Content">ê¸°ë¡ ì—†ìŒ</div>
    </div>
    <div class="week-box">
      <h4>2ì£¼ì°¨</h4>
      <div class="content empty" id="week2Content">ê¸°ë¡ ì—†ìŒ</div>
    </div>
    <div class="week-box">
      <h4>3ì£¼ì°¨</h4>
      <div class="content empty" id="week3Content">ê¸°ë¡ ì—†ìŒ</div>
    </div>
    <div class="week-box">
      <h4>4ì£¼ì°¨</h4>
      <div class="content empty" id="week4Content">ê¸°ë¡ ì—†ìŒ</div>
    </div>
    <div class="week-box">
      <h4>5ì£¼ì°¨</h4>
      <div class="content empty" id="week5Content">ê¸°ë¡ ì—†ìŒ</div>
    </div>
  </div>
</div>

<script>
const SUPABASE_URL = 'https://vqimgnjodisawujcwfuv.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxaW1nbmpvZGlzYXd1amN3ZnV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMjkzOTYsImV4cCI6MjA3ODYwNTM5Nn0.j31IoziLjkiQ0r7il8PUOEv9ylGm6ZTIVGSVDVgS5F0';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ì¥ë¹„ ë°ì´í„° ì •ì˜
const equipments = {
  "1. ìŠ¤í¬ë˜ë°”": [
    { code: "check1-1", part: "ëª¨í„°", point: "ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check1-2", part: "ë²¨íŠ¸", point: "ì ì • ì¥ë ¥ìœ ì§€ í™•ì¸", standard: "ì¶œë ì´ì§€ ì•Šì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check1-3", part: "ë³¸ì²´", point: "ë…¸ì¦ ë¶„ì‚¬ ì—¬ë¶€ í™•ì¸", standard: "ë¶„ì‚¬ê°€ ë ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check1-4", part: "ë³¸ì²´", point: "ì €ì¥ì¡° ì ì • ìˆ˜ìœ„ í™•ì¸", standard: "ë³¼íƒ‘ê¹Œì§€ ì±„ìš¸ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check1-5", part: "ë³¸ì²´", point: "ê· ì—´ í™•ì¸", standard: "ëˆ„ìˆ˜ê°€ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check1-6", part: "ë³¸ì²´", point: "ì €ì¥ì¡° PH í™•ì¸", standard: "PH7 ì´ìƒì¼ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check1-7", part: "ë² ì–´ë§", point: "ê·¸ë¦¬ìŠ¤ ì£¼ì…", standard: "ê°€ë“ ì±„ìš¸ê²ƒ", freq: "1íšŒ/ì›”" }
  ],
  "2. ìˆœìˆ˜ì„¤ë¹„50": [
    { code: "check2-1", part: "ì „ë„ë„", point: "íŒë„¬í™•ì¸", standard: "1ã ì´ìƒ", freq: "1íšŒ/ì¼" },
    { code: "check2-2", part: "íŒí”„", point: "ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check2-3", part: "íŒí”„", point: "ëˆ„ìˆ˜ í™•ì¸", standard: "ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check2-4", part: "ë°°ê´€", point: "ëˆ„ìˆ˜ í™•ì¸", standard: "ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check2-5", part: "í•„í„°", point: "ì…/ì¶œêµ¬ ì••ë ¥ í¸ì°¨", standard: "2k ì´í•˜", freq: "1íšŒ/ì£¼" },
    { code: "check2-6", part: "ë©¤ë¸Œë ˆì¸", point: "ìƒì‚° ìœ ëŸ‰", standard: "35L/min ì´ìƒ", freq: "1íšŒ/ì£¼" },
    { code: "check2-7", part: "ì œì–´ë°˜", point: "ì „ê¸°ë°°ì„ ", standard: "í”¼ë³µ ë²—ê²¨ì§ ì—†ì„ê²ƒ", freq: "1íšŒ/ì›”" }
  ],
  "3. ìˆœìˆ˜ì„¤ë¹„100": [
    { code: "check3-1", part: "ì „ë„ë„", point: "íŒë„¬í™•ì¸", standard: "1ã ì´ìƒ", freq: "1íšŒ/ì¼" },
    { code: "check3-2", part: "íŒí”„", point: "ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check3-3", part: "íŒí”„", point: "ëˆ„ìˆ˜ í™•ì¸", standard: "ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check3-4", part: "ë°°ê´€", point: "ëˆ„ìˆ˜ í™•ì¸", standard: "ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check3-5", part: "í•„í„°", point: "ì…/ì¶œêµ¬ ì••ë ¥ í¸ì°¨", standard: "2k ì´í•˜", freq: "1íšŒ/ì£¼" },
    { code: "check3-6", part: "ë©¤ë¸Œë ˆì¸", point: "ìƒì‚° ìœ ëŸ‰", standard: "6 ton ì´ìƒ", freq: "1íšŒ/ì£¼" },
    { code: "check3-7", part: "ì œì–´ë°˜", point: "ì „ê¸°ë°°ì„ ", standard: "í”¼ë³µ ë²—ê²¨ì§ ì—†ì„ê²ƒ", freq: "1íšŒ/ì›”" }
  ],
  "4. ìˆœìˆ˜ì„¤ë¹„200": [
    { code: "check4-1", part: "ì „ë„ë„", point: "íŒë„¬í™•ì¸", standard: "5ã ì´ìƒ", freq: "1íšŒ/ì¼" },
    { code: "check4-2", part: "íŒí”„", point: "ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check4-3", part: "íŒí”„", point: "ëˆ„ìˆ˜ í™•ì¸", standard: "ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check4-4", part: "ë°°ê´€", point: "ëˆ„ìˆ˜ í™•ì¸", standard: "ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check4-5", part: "í•„í„°", point: "ì…/ì¶œêµ¬ ì••ë ¥ í¸ì°¨", standard: "2k ì´í•˜", freq: "1íšŒ/ì£¼" },
    { code: "check4-6", part: "ë©¤ë¸Œë ˆì¸", point: "ìƒì‚° ìœ ëŸ‰", standard: "10 ton ì´ìƒ", freq: "1íšŒ/ì£¼" },
    { code: "check4-7", part: "ì œì–´ë°˜", point: "ì „ê¸°ë°°ì„  í™•ì¸", standard: "í”¼ë³µ ë²—ê²¨ì§ ì—†ì„ê²ƒ", freq: "1íšŒ/ì›”" }
  ],
  "5. ìŠ¤í¬ë¥˜ì½¤í”„": [
    { code: "check5-1", part: "ëª¨í„°", point: "ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check5-2", part: "í¡ì°©ì‹ ë“œë¼ì´ì–´", point: "ìŠ¤ìœ„ì¹˜ í™•ì¸", standard: "ON ìƒíƒœì¼ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check5-3", part: "ê³µê¸°íƒ±í¬", point: "ìˆ˜ë¶„ ë°°ì¶œ", standard: "ë°¸ë¸Œ ì˜¤í”ˆí•˜ì—¬ ë°°ì¶œ", freq: "1íšŒ/ì¼" },
    { code: "check5-4", part: "ì••ì¶•ê¸°", point: "ì†ŒìŒ í™•ì¸", standard: "êµ‰ìŒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check5-5", part: "ì••ì¶•ê¸°", point: "ê·¸ë¦¬ìŠ¤ ì£¼ì…", standard: "ê°€ë“ ì±„ìš¸ê²ƒ", freq: "1íšŒ/ì›”" },
    { code: "check5-6", part: "ì œì–´ë°˜", point: "ì „ì ì ‘ì´‰ê¸° ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì›”" },
    { code: "check5-7", part: "ì œì–´ë°˜", point: "ì „ê¸°ë°°ì„  ì—´í™”ìƒíƒœ", standard: "í”¼ë³µ ë²—ê²¨ì§ ì—†ì„ê²ƒ", freq: "1íšŒ/ì›”" }
  ],
  "6. ì˜¤ì¼í”„ë¦¬ì½¤í”„50": [
    { code: "check6-1", part: "ëª¨í„°", point: "ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check6-2", part: "í¡ì°©ì‹ ë“œë¼ì´ì–´", point: "ìŠ¤ìœ„ì¹˜ í™•ì¸", standard: "ON ìƒíƒœì¼ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check6-3", part: "ê³µê¸°íƒ±í¬", point: "ìˆ˜ë¶„ ë°°ì¶œ", standard: "ë°¸ë¸Œ ì˜¤í”ˆí•˜ì—¬ ë°°ì¶œ", freq: "1íšŒ/ì¼" },
    { code: "check6-4", part: "ì••ì¶•ê¸°", point: "ì••ë ¥í™•ì¸", standard: "3K ì´ìƒì¼ ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check6-5", part: "ì••ì¶•ê¸°", point: "ë²¨íŠ¸ í™•ì¸", standard: "íŒŒì†ì´ ì—†ì„ê²ƒ", freq: "1íšŒ/ì£¼" },
    { code: "check6-6", part: "ì œì–´ë°˜", point: "ì „ì ì ‘ì´‰ê¸° ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì›”" },
    { code: "check6-7", part: "ì œì–´ë°˜", point: "ì „ê¸°ë°°ì„  ì—´í™”ìƒíƒœ", standard: "í”¼ë³µ ë²—ê²¨ì§ ì—†ì„ê²ƒ", freq: "1íšŒ/ì›”" }
  ],
  "7. ì˜¤ì¼í”„ë¦¬ì½¤í”„100": [
    { code: "check7-1", part: "ëª¨í„°", point: "ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check7-2", part: "í¡ì°©ì‹ ë“œë¼ì´ì–´", point: "ìŠ¤ìœ„ì¹˜ í™•ì¸", standard: "ON ìƒíƒœì¼ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check7-3", part: "ê³µê¸°íƒ±í¬", point: "ìˆ˜ë¶„ ë°°ì¶œ", standard: "ë°¸ë¸Œ ì˜¤í”ˆí•˜ì—¬ ë°°ì¶œ", freq: "1íšŒ/ì¼" },
    { code: "check7-4", part: "ì••ì¶•ê¸°", point: "ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì¼" },
    { code: "check7-5", part: "ì••ì¶•ê¸°", point: "ê·¸ë¦¬ìŠ¤ ì£¼ì…", standard: "ê°€ë“ ì±„ìš¸ê²ƒ", freq: "1íšŒ/ì›”" },
    { code: "check7-6", part: "ì œì–´ë°˜", point: "ì „ì ì ‘ì´‰ê¸° ì†ŒìŒ í™•ì¸", standard: "ì´ìƒ ì—†ì„ê²ƒ", freq: "1íšŒ/ì›”" },
    { code: "check7-7", part: "ì œì–´ë°˜", point: "ì „ê¸°ë°°ì„  ì—´í™”ìƒíƒœ", standard: "í”¼ë³µ ë²—ê²¨ì§ ì—†ì„ê²ƒ", freq: "1íšŒ/ì›”" }
  ]
};

// ì—°ë„ ì„ íƒ ì´ˆê¸°í™” (í˜„ì¬ ì—°ë„ ê¸°ì¤€ -2ë…„ ~ +1ë…„)
function initYearSelect() {
  const yearSelect = document.getElementById('yearSelect');
  const currentYear = new Date().getFullYear();
  
  for (let year = currentYear - 2; year <= currentYear + 1; year++) {
    const option = document.createElement('option');
    option.value = year;
    option.textContent = year + 'ë…„';
    if (year === currentYear) option.selected = true;
    yearSelect.appendChild(option);
  }
}

// í•´ë‹¹ ì›”ì˜ ì¼ìˆ˜ ê³„ì‚°
function getDaysInMonth(year, month) {
  return new Date(year, month, 0).getDate();
}

// ì¥ë¹„ëª… í¬ë§·íŒ… í•¨ìˆ˜ (ì´ë¯¸ ë²ˆí˜¸ê°€ í¬í•¨ë˜ì–´ ìˆìŒ)
function formatEquipmentName(name) {
  return name;
}

// ì¡°íšŒ ë²„íŠ¼ í´ë¦­
document.getElementById('searchBtn').addEventListener('click', async () => {
  const equipment = document.getElementById('equipmentSelect').value;
  const year = document.getElementById('yearSelect').value;
  const month = document.getElementById('monthSelect').value;
  
  if (!equipment || !year || !month) {
    alert('ì¥ë¹„, ì—°ë„, ì›”ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ì¶œë ¥ìš© ì •ë³´ ì—…ë°ì´íŠ¸ (í¬ë§·íŒ…ëœ ì¥ë¹„ëª… ì‚¬ìš©)
  document.getElementById('printEquipName').textContent = formatEquipmentName(equipment);
  document.getElementById('printMonth').textContent = `${year}ë…„ ${month}ì›”`;
  
  await loadData(equipment, year, month);
});

async function loadData(equipment, year, month) {
  const tableContent = document.getElementById('tableContent');
  tableContent.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
  
  try {
    // í•´ë‹¹ ì›”ì˜ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ ê³„ì‚°
    const startDate = `${year}-${month.padStart(2, '0')}-01`;
    const daysInMonth = getDaysInMonth(year, parseInt(month));
    const endDate = `${year}-${month.padStart(2, '0')}-${daysInMonth}`;
    
    // Supabaseì—ì„œ ë°ì´í„° ì¡°íšŒ
    const { data, error } = await supabase
      .from('check_logs')
      .select('*')
      .eq('equipment', equipment)
      .gte('check_time', startDate)
      .lt('check_time', `${year}-${(parseInt(month) + 1).toString().padStart(2, '0')}-01`)
      .order('check_time', { ascending: true });
    
    if (error) {
      throw error;
    }
    
    // ë°ì´í„° ì²˜ë¦¬ ë° í…Œì´ë¸” ìƒì„±
    renderTable(equipment, year, month, daysInMonth, data);
    
    // íŠ¹ì´ì‚¬í•­ ë¡œë“œ
    await loadSpecialNotes(data);
    
  } catch (error) {
    console.error('Error:', error);
    tableContent.innerHTML = `<div class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}</div>`;
  }
}

function renderTable(equipment, year, month, daysInMonth, data) {
  const tableContent = document.getElementById('tableContent');
  const checkItems = equipments[equipment];
  
  if (!checkItems) {
    tableContent.innerHTML = '<div class="no-data">ì¥ë¹„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
    return;
  }
  
  // ìˆ«ìë¡œ í‘œì‹œí•´ì•¼ í•˜ëŠ” í•­ëª©ë“¤ (ì¸¡ì •ê°’ í•­ëª©)
  const numericCodes = [
    'check1-6',                            // ì €ì¥ì¡° PH í™•ì¸
    'check2-1', 'check3-1', 'check4-1',  // ì „ë„ë„
    'check2-5', 'check3-5', 'check4-5',  // ì••ë ¥ í¸ì°¨
    'check2-6', 'check3-6', 'check4-6',  // ìƒì‚° ìœ ëŸ‰
    'check6-4'                             // ì••ë ¥í™•ì¸
  ];
  
  // ë°ì´í„°ë¥¼ ë‚ ì§œë³„, ì½”ë“œë³„ë¡œ ì •ë¦¬ (ì œì¶œì‹œê°„ë„ í•¨ê»˜)
  const dataMap = {};
  const timeMap = {};
  data.forEach(record => {
    const date = new Date(record.check_time);
    const day = date.getDate();
    const code = record.check_code;
    
    if (!dataMap[code]) dataMap[code] = {};
    if (!timeMap[day]) timeMap[day] = '';
    
    dataMap[code][day] = record.check_result;
    
    // í•´ë‹¹ ë‚ ì§œì˜ ê°€ì¥ ìµœê·¼ ì œì¶œ ì‹œê°„ ì €ì¥
    const timeStr = date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
    if (!timeMap[day] || timeMap[day] < timeStr) {
      timeMap[day] = timeStr;
    }
  });
  
  // í…Œì´ë¸” HTML ìƒì„±
  let html = '<table><thead><tr>';
  html += '<th class="fixed-col-header-1">ì½”ë“œ</th>';
  html += '<th class="fixed-col-header-2">ë¶€ìœ„</th>';
  html += '<th class="fixed-col-header-3">ì ê²€í•­ëª©</th>';
  html += '<th class="fixed-col-header-4">ê¸°ì¤€</th>';
  html += '<th class="fixed-col-header-5">ë¹ˆë„</th>';
  
  // ë‚ ì§œ í—¤ë” (1ì¼~31ì¼)
  for (let day = 1; day <= daysInMonth; day++) {
    html += `<th class="day-header">${day}ì¼</th>`;
  }
  html += '</tr></thead><tbody>';
  
  // ê° ì²´í¬ í•­ëª©ë³„ í–‰ ìƒì„±
  checkItems.forEach(item => {
    html += '<tr>';
    html += `<td class="fixed-col-1">${item.code}</td>`;
    html += `<td class="fixed-col-2 info-col">${item.part}</td>`;
    html += `<td class="fixed-col-3 info-col">${item.point}</td>`;
    html += `<td class="fixed-col-4 info-col">${item.standard}</td>`;
    html += `<td class="fixed-col-5">${item.freq}</td>`;
    
    // ê° ë‚ ì§œë³„ ê²°ê³¼ê°’
    for (let day = 1; day <= daysInMonth; day++) {
      const result = dataMap[item.code]?.[day] || '';
      let cellClass = 'result-cell';
      let displayValue = '-';
      
      if (result) {
        // ìˆ«ìë¡œ í‘œì‹œí•´ì•¼ í•˜ëŠ” í•­ëª©
        if (numericCodes.includes(item.code)) {
          cellClass += ' result-text';
          displayValue = result;
        }
        // ì •ìƒ/OK/1 ë“±ì€ ì²´í¬ í‘œì‹œ
        else if (result === 'ì •ìƒ' || result === 'OK' || result === 'ok' || result === '1' || result === 'O' || result === 'o') {
          cellClass += ' result-ok';
          displayValue = 'âœ“';
        } 
        // ë¹„ì •ìƒ/NG/0 ë“±ì€ X í‘œì‹œ
        else if (result === 'ë¹„ì •ìƒ' || result === 'NG' || result === 'ng' || result === '0' || result === 'X' || result === 'x') {
          cellClass += ' result-ng';
          displayValue = 'âœ—';
        } 
        // ë‚˜ë¨¸ì§€ëŠ” í…ìŠ¤íŠ¸ ê·¸ëŒ€ë¡œ
        else {
          cellClass += ' result-text';
          displayValue = result.length > 8 ? result.substring(0, 8) + '...' : result;
        }
      }
      
      html += `<td class="${cellClass}" title="${result}">${displayValue}</td>`;
    }
    html += '</tr>';
  });
  
  // ì œì¶œ ì‹œê°„ í–‰ ì¶”ê°€
  html += '<tr style="background: #e8f4f8;">';
  html += '<td class="fixed-col-1" colspan="5" style="text-align: left; font-weight: bold; padding-left: 10px;">ğŸ“… ì œì¶œ ì‹œê°„</td>';
  for (let day = 1; day <= daysInMonth; day++) {
    const timeStr = timeMap[day] || '-';
    html += `<td class="result-cell" style="font-size: 11px; color: #666;">${timeStr}</td>`;
  }
  html += '</tr>';
  
  html += '</tbody></table>';
  
  if (data.length === 0) {
    html = '<div class="no-data">í•´ë‹¹ ê¸°ê°„ì— ê¸°ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
  }
  
  tableContent.innerHTML = html;
}

// íŠ¹ì´ì‚¬í•­ ë¡œë“œ
async function loadSpecialNotes(data) {
  const specialNotesSection = document.getElementById('specialNotesSection');
  
  // ì£¼ì°¨ë³„ íŠ¹ì´ì‚¬í•­ ë°ì´í„° ì¶”ì¶œ
  const weekNotes = {
    week1: '',
    week2: '',
    week3: '',
    week4: '',
    week5: ''
  };
  
  // ë°ì´í„°ì—ì„œ ì£¼ì°¨ë³„ íŠ¹ì´ì‚¬í•­ ì°¾ê¸°
  data.forEach(record => {
    if (record.check_code && record.check_code.includes('week') && record.check_code.includes('note')) {
      const weekKey = record.check_code.split('-')[0]; // week1, week2, etc.
      if (weekNotes.hasOwnProperty(weekKey)) {
        weekNotes[weekKey] = record.check_result || '';
      }
    }
  });
  
  // ì£¼ì°¨ë³„ íŠ¹ì´ì‚¬í•­ í‘œì‹œ
  let hasData = false;
  for (let i = 1; i <= 5; i++) {
    const weekKey = `week${i}`;
    const contentDiv = document.getElementById(`${weekKey}Content`);
    
    if (weekNotes[weekKey] && weekNotes[weekKey].trim() !== '') {
      contentDiv.textContent = weekNotes[weekKey];
      contentDiv.classList.remove('empty');
      hasData = true;
    } else {
      contentDiv.textContent = 'ê¸°ë¡ ì—†ìŒ';
      contentDiv.classList.add('empty');
    }
  }
  
  // íŠ¹ì´ì‚¬í•­ ì„¹ì…˜ í‘œì‹œ (ë°ì´í„°ê°€ ìˆë“  ì—†ë“  í•­ìƒ í‘œì‹œ)
  specialNotesSection.style.display = 'block';
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì—°ë„ ì„ íƒ ì´ˆê¸°í™”
initYearSelect();
</script>

</body>
</html>
