<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>1. ìŠ¤í¬ë˜ë°” ì ê²€ ì²´í¬ì‹œíŠ¸</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  body { font-family: "Noto Sans KR", sans-serif; margin: 20px; }
  h2 { color: #333; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #f5f5f5; font-weight: bold; }
  input[type="text"] { width: 100%; padding: 4px; box-sizing: border-box; }
  label { margin-right: 10px; cursor: pointer; }
  input[type="radio"] { margin-right: 3px; cursor: pointer; }
  button { margin-top: 15px; padding: 10px 20px; border: none; border-radius: 8px; background: #007bff; color: white; cursor: pointer; font-size: 16px; }
  button:hover { background: #0056b3; }
  button:disabled { background: #ccc; cursor: not-allowed; }
  .access-denied { 
    background: #f8d7da; 
    color: #721c24; 
    padding: 20px; 
    border-radius: 8px; 
    margin: 20px 0; 
    text-align: center;
    border: 2px solid #f5c6cb;
  }
  .access-granted {
    background: #d4edda;
    color: #155724;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 10px;
    text-align: center;
  }
</style>
</head>
<body>

<h2>1. ìŠ¤í¬ë˜ë°” ì ê²€ ì²´í¬ì‹œíŠ¸</h2>

<div id="accessStatus"></div>

<div id="contentArea" style="display: none;">
  <table>
    <tr>
      <th>ì½”ë“œ</th><th>ë¶€ìœ„</th><th>ì ê²€í•­ëª©</th><th>ê¸°ì¤€</th><th>ë¹ˆë„</th><th>ê²°ê³¼ì…ë ¥</th>
    </tr>
    <tr>
      <td>check1-1</td>
      <td>ëª¨í„°</td>
      <td>ì†ŒìŒ í™•ì¸</td>
      <td>ì´ìƒ ì—†ì„ê²ƒ</td>
      <td>1íšŒ/ì¼</td>
      <td>
        <label><input type="radio" name="check1-1" value="ì •ìƒ" checked> ì •ìƒ</label>
        <label><input type="radio" name="check1-1" value="ë¹„ì •ìƒ"> ë¹„ì •ìƒ</label>
      </td>
    </tr>
    <tr>
      <td>check1-2</td>
      <td>ë²¨íŠ¸</td>
      <td>ì ì • ì¥ë ¥ìœ ì§€ í™•ì¸</td>
      <td>ì¶œë ì´ì§€ ì•Šì„ê²ƒ</td>
      <td>1íšŒ/ì¼</td>
      <td>
        <label><input type="radio" name="check1-2" value="ì •ìƒ" checked> ì •ìƒ</label>
        <label><input type="radio" name="check1-2" value="ë¹„ì •ìƒ"> ë¹„ì •ìƒ</label>
      </td>
    </tr>
    <tr>
      <td>check1-3</td>
      <td>ë³¸ì²´</td>
      <td>ë…¸ì¦ ë¶„ì‚¬ ì—¬ë¶€ í™•ì¸</td>
      <td>ë¶„ì‚¬ê°€ ë ê²ƒ</td>
      <td>1íšŒ/ì¼</td>
      <td>
        <label><input type="radio" name="check1-3" value="ì •ìƒ" checked> ì •ìƒ</label>
        <label><input type="radio" name="check1-3" value="ë¹„ì •ìƒ"> ë¹„ì •ìƒ</label>
      </td>
    </tr>
    <tr>
      <td>check1-4</td>
      <td>ë³¸ì²´</td>
      <td>ì €ì¥ì¡° ì ì • ìˆ˜ìœ„ í™•ì¸</td>
      <td>ë³¼íƒ‘ê¹Œì§€ ì±„ìš¸ê²ƒ</td>
      <td>1íšŒ/ì¼</td>
      <td>
        <label><input type="radio" name="check1-4" value="ì •ìƒ" checked> ì •ìƒ</label>
        <label><input type="radio" name="check1-4" value="ë¹„ì •ìƒ"> ë¹„ì •ìƒ</label>
      </td>
    </tr>
    <tr>
      <td>check1-5</td>
      <td>ë³¸ì²´</td>
      <td>ê· ì—´ í™•ì¸</td>
      <td>ëˆ„ìˆ˜ê°€ ì—†ì„ê²ƒ</td>
      <td>1íšŒ/ì¼</td>
      <td>
        <label><input type="radio" name="check1-5" value="ì •ìƒ" checked> ì •ìƒ</label>
        <label><input type="radio" name="check1-5" value="ë¹„ì •ìƒ"> ë¹„ì •ìƒ</label>
      </td>
    </tr>
    <tr>
      <td>check1-6</td>
      <td>ë³¸ì²´</td>
      <td>ì €ì¥ì¡° PH í™•ì¸</td>
      <td>PH7 ì´ìƒì¼ê²ƒ</td>
      <td>1íšŒ/ì¼</td>
      <td><input type="text" id="check1-6" placeholder="ì ê²€ ê²°ê³¼ ì…ë ¥"></td>
    </tr>
    <tr>
      <td>check1-7</td>
      <td>ë² ì–´ë§</td>
      <td>ê·¸ë¦¬ìŠ¤ ì£¼ì…</td>
      <td>ê°€ë“ ì±„ìš¸ê²ƒ</td>
      <td>1íšŒ/ì›”</td>
      <td>
        <label><input type="radio" name="check1-7" value="ì •ìƒ" checked> ì •ìƒ</label>
        <label><input type="radio" name="check1-7" value="ë¹„ì •ìƒ"> ë¹„ì •ìƒ</label>
      </td>
    </tr>
    <tr>
      <td>check1-8</td>
      <td>ì¢…í•©</td>
      <td>íŠ¹ì´ì‚¬í•­</td>
      <td></td>
      <td></td>
      <td><input type="text" id="check1-8" placeholder="ì ê²€ ê²°ê³¼ ì…ë ¥"></td>
    </tr>
  </table>

  <button id="saveBtn">ì‘ì„± ì™„ë£Œ</button>
</div>

<script>
const SUPABASE_URL = 'https://vqimgnjodisawujcwfuv.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxaW1nbmpvZGlzYXd1amN3ZnV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMjkzOTYsImV4cCI6MjA3ODYwNTM5Nn0.j31IoziLjkiQ0r7il8PUOEv9ylGm6ZTIVGSVDVgS5F0';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ğŸ” ë³´ì•ˆ í† í° ì„¤ì • (ì´ í† í°ì„ QRì½”ë“œ URLì— í¬í•¨ì‹œì¼œì•¼ í•©ë‹ˆë‹¤)
const VALID_TOKEN = 'EQUIP_CHECK_2024_SECURE';

const equipmentName = '1. ìŠ¤í¬ë˜ë°”';
const textInputCodes = ["check1-6", "check1-8"];
const checkItems = [{"code": "check1-1", "part": "ëª¨í„°", "point": "ì†ŒìŒ í™•ì¸", "standard": "ì´ìƒ ì—†ì„ê²ƒ", "freq": "1íšŒ/ì¼"}, {"code": "check1-2", "part": "ë²¨íŠ¸", "point": "ì ì • ì¥ë ¥ìœ ì§€ í™•ì¸", "standard": "ì¶œë ì´ì§€ ì•Šì„ê²ƒ", "freq": "1íšŒ/ì¼"}, {"code": "check1-3", "part": "ë³¸ì²´", "point": "ë…¸ì¦ ë¶„ì‚¬ ì—¬ë¶€ í™•ì¸", "standard": "ë¶„ì‚¬ê°€ ë ê²ƒ", "freq": "1íšŒ/ì¼"}, {"code": "check1-4", "part": "ë³¸ì²´", "point": "ì €ì¥ì¡° ì ì • ìˆ˜ìœ„ í™•ì¸", "standard": "ë³¼íƒ‘ê¹Œì§€ ì±„ìš¸ê²ƒ", "freq": "1íšŒ/ì¼"}, {"code": "check1-5", "part": "ë³¸ì²´", "point": "ê· ì—´ í™•ì¸", "standard": "ëˆ„ìˆ˜ê°€ ì—†ì„ê²ƒ", "freq": "1íšŒ/ì¼"}, {"code": "check1-6", "part": "ë³¸ì²´", "point": "ì €ì¥ì¡° PH í™•ì¸", "standard": "PH7 ì´ìƒì¼ê²ƒ", "freq": "1íšŒ/ì¼"}, {"code": "check1-7", "part": "ë² ì–´ë§", "point": "ê·¸ë¦¬ìŠ¤ ì£¼ì…", "standard": "ê°€ë“ ì±„ìš¸ê²ƒ", "freq": "1íšŒ/ì›”"}, {"code": "check1-8", "part": "ì¢…í•©", "point": "íŠ¹ì´ì‚¬í•­", "standard": "", "freq": ""}];

// ğŸ” í† í° ê²€ì¦ í•¨ìˆ˜
function verifyAccess() {
  const urlParams = new URLSearchParams(window.location.search);
  const token = urlParams.get('token');
  
  // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì €ì¥ëœ í† í° í™•ì¸
  const savedToken = sessionStorage.getItem('access_token');
  
  if (token === VALID_TOKEN) {
    // ìœ íš¨í•œ í† í°ì´ë©´ ì„¸ì…˜ì— ì €ì¥
    sessionStorage.setItem('access_token', token);
    return true;
  } else if (savedToken === VALID_TOKEN) {
    // ì„¸ì…˜ì— ì €ì¥ëœ í† í°ì´ ìœ íš¨í•˜ë©´ í—ˆìš© (ìƒˆë¡œê³ ì¹¨ ëŒ€ì‘)
    return true;
  }
  
  return false;
}

// ğŸ” í˜ì´ì§€ ë¡œë“œ ì‹œ ì ‘ê·¼ ê¶Œí•œ í™•ì¸
window.addEventListener('DOMContentLoaded', () => {
  const accessStatus = document.getElementById('accessStatus');
  const contentArea = document.getElementById('contentArea');
  const saveBtn = document.getElementById('saveBtn');
  
  if (verifyAccess()) {
    // âœ… ì ‘ê·¼ í—ˆìš©
    accessStatus.innerHTML = '<div class="access-granted">âœ… QRì½”ë“œë¥¼ í†µí•œ ì •ìƒ ì ‘ê·¼ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
    contentArea.style.display = 'block';
  } else {
    // âŒ ì ‘ê·¼ ê±°ë¶€
    accessStatus.innerHTML = `
      <div class="access-denied">
        <h3>âš ï¸ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>ì´ í˜ì´ì§€ëŠ” QRì½”ë“œë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <p>ì˜¬ë°”ë¥¸ QRì½”ë“œë¥¼ ìŠ¤ìº”í•´ì£¼ì„¸ìš”.</p>
      </div>
    `;
    contentArea.style.display = 'none';
  }
});

// ğŸ’¾ ì €ì¥ ë²„íŠ¼ í´ë¦­
document.getElementById('saveBtn').addEventListener('click', async () => {
  // ì €ì¥ ì‹œì ì— ë‹¤ì‹œ í•œë²ˆ í† í° í™•ì¸
  if (!verifyAccess()) {
    alert('âš ï¸ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. QRì½”ë“œë¥¼ í†µí•´ ì ‘ì†í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const now = new Date().toISOString();
  const records = [];

  checkItems.forEach(item => {
    let val = '';
    if (textInputCodes.includes(item.code)) {
      val = document.getElementById(item.code)?.value || '';
    } else {
      const radio = document.querySelector(`input[name="${item.code}"]:checked`);
      val = radio ? radio.value : 'ì •ìƒ';
    }
    
    if (val.trim() !== '') {
      records.push({
        check_code: item.code,
        equipment: equipmentName,
        check_result: val,
        check_time: now
      });
    }
  });

  if (records.length === 0) {
    alert('ì…ë ¥ê°’ì´ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }

  const { error } = await supabase.from('check_logs').insert(records);
  if (error) {
    alert('ì €ì¥ ì‹¤íŒ¨: ' + error.message);
  } else {
    alert('ì €ì¥ ì™„ë£Œ!');
    // ì…ë ¥ê°’ ì´ˆê¸°í™” (ì„ íƒì‚¬í•­)
    // location.reload();
  }
});
</script>
</body>
</html>
